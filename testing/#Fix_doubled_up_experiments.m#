clear all
% cp -a old/. new-1/

%%%%%%%%%%%%%%%%%%% MAKE SURE TO DUPLICATE FOLDER BEFORE RUNNING

this_path = uigetdir('/groups/sutphin/');

this_dir = dir(this_path);

this_dir=this_dir(~ismember({this_dir.name},{'.','..'}));

num_in_replicate = 25;

this_replicate = 2;
num_replicates = 2;

for i = 1:length(this_dir)
    
    disp(this_dir(i).name)
    
    temp_dir_step = dir(fullfile(this_dir(i).folder,this_dir(i).name));
    temp_dir_step=temp_dir_step(~ismember({temp_dir_step.name},{'.','..'}));
    
    num_images = length(temp_dir_step);
    
    entire_dir_vector = 1:num_images;
    delete_idx = entire_dir_vector;
    
    if rem(num_images,num_in_replicate)
        error('incorrect number of images')
    end
    
    sessions = num_images/num_in_replicate;
    
    k=1;
    for j = this_replicate:num_replicates:sessions
        keep_these_sessions(k) = j;
        k=k+1;
    end    
    
    img_vector = 1:25;
    
    keep_idx = [];
    for j = 1:length(keep_these_sessions)
        keep_idx = [keep_idx ((keep_these_sessions(j)-1)*num_in_replicate)+img_vector];
    end
    
    delete_idx(keep_idx) = 0;
    delete_idx = nonzeros(delete_idx);
    
    
    for j = 1:length(delete_idx)
        this_img_path = fullfile(temp_dir_step(delete_idx(j)).folder,temp_dir_step(delete_idx(j)).name);
        delete(this_img_path)
    end
    
    
end